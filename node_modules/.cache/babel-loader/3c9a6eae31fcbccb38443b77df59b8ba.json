{"ast":null,"code":"import _objectSpread from \"D:\\\\React\\\\PROEKTI\\\\hook_news\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread\";\nimport _slicedToArray from \"D:\\\\React\\\\PROEKTI\\\\hook_news\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"D:\\\\React\\\\PROEKTI\\\\hook_news\\\\src\\\\components\\\\Link\\\\LinkList.js\";\nimport React from \"react\";\nimport FirebaseContext from \"../../firebase/context\";\nimport LinkItem from \"./LinkItem\";\nimport { LINKS_PER_PAGE } from \"../../utils/index\";\nimport axios from \"axios\";\n\nfunction LinkList(props) {\n  var _this = this;\n\n  var _React$useContext = React.useContext(FirebaseContext),\n      firebase = _React$useContext.firebase;\n\n  var _React$useState = React.useState([]),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      links = _React$useState2[0],\n      setLinks = _React$useState2[1];\n\n  var _React$useState3 = React.useState(null),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      cursor = _React$useState4[0],\n      setCursor = _React$useState4[1];\n\n  var _React$useState5 = React.useState(false),\n      _React$useState6 = _slicedToArray(_React$useState5, 2),\n      loading = _React$useState6[0],\n      setLoading = _React$useState6[1];\n\n  var isNewPage = props.location.pathname.includes(\"new\");\n  var isTopPage = props.location.pathname.includes(\"top\");\n  var page = Number(props.match.params.page);\n  var linksRef = firebase.db.collection(\"links\");\n  React.useEffect(function () {\n    var unsubscribe = getLinks();\n    return function () {\n      return unsubscribe();\n    };\n  }, [isTopPage, page]);\n\n  function getLinks() {\n    var hasCursor = Boolean(cursor);\n    setLoading(true);\n\n    if (isTopPage) {\n      return linksRef.orderBy(\"voteCount\", \"desc\").limit(LINKS_PER_PAGE).onSnapshot(handleSnapshot);\n    } else if (page === 1) {\n      return linksRef.orderBy(\"created\", \"desc\").limit(LINKS_PER_PAGE).onSnapshot(handleSnapshot);\n    } else if (hasCursor) {\n      return linksRef.orderBy(\"created\", \"desc\").startAfter(cursor.created).limit(LINKS_PER_PAGE).onSnapshot(handleSnapshot);\n    } else {\n      var offset = page * LINKS_PER_PAGE - LINKS_PER_PAGE;\n      axios.get(\"https://us-central1-hooks-news-app.cloudfunctions.net/linksPagination?offset=\".concat(offset)).then(function (response) {\n        var links = response.data;\n        var lastLink = links[links.length - 1];\n        setLinks(links);\n        setCursor(lastLink);\n        setLoading(false);\n      });\n      return function () {};\n    }\n  }\n\n  function handleSnapshot(snapshot) {\n    var links = snapshot.docs.map(function (doc) {\n      return _objectSpread({\n        id: doc.id\n      }, doc.data());\n    });\n    var lastLink = links[links.length - 1];\n    setLinks(links);\n    setCursor(lastLink);\n    setLoading(false);\n  }\n\n  function visitPreviousPage() {\n    if (page > 1) {\n      props.history.push(\"/new/\".concat(page - 1));\n    }\n  }\n\n  function visitNextPage() {\n    if (page <= links.length / LINKS_PER_PAGE) {\n      props.history.push(\"/new/\".concat(page + 1));\n    }\n  }\n\n  var pageIndex = page ? (page - 1) * LINKS_PER_PAGE + 1 : 0;\n  return /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      opacity: loading ? 0.25 : 1\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 5\n    }\n  }, links.map(function (link, index) {\n    return /*#__PURE__*/React.createElement(LinkItem, {\n      key: link.id,\n      showCount: true,\n      link: link,\n      index: index + pageIndex,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 9\n      }\n    });\n  }), isNewPage && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"pagination\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"pointer mr2\",\n    onClick: visitPreviousPage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 11\n    }\n  }, \"Previous\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"pointer\",\n    onClick: visitNextPage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 11\n    }\n  }, \"Next\")));\n}\n\nexport default LinkList;","map":{"version":3,"sources":["D:/React/PROEKTI/hook_news/src/components/Link/LinkList.js"],"names":["React","FirebaseContext","LinkItem","LINKS_PER_PAGE","axios","LinkList","props","useContext","firebase","useState","links","setLinks","cursor","setCursor","loading","setLoading","isNewPage","location","pathname","includes","isTopPage","page","Number","match","params","linksRef","db","collection","useEffect","unsubscribe","getLinks","hasCursor","Boolean","orderBy","limit","onSnapshot","handleSnapshot","startAfter","created","offset","get","then","response","data","lastLink","length","snapshot","docs","map","doc","id","visitPreviousPage","history","push","visitNextPage","pageIndex","opacity","link","index"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport FirebaseContext from \"../../firebase/context\";\nimport LinkItem from \"./LinkItem\";\nimport { LINKS_PER_PAGE } from \"../../utils/index\";\nimport axios from \"axios\";\n\nfunction LinkList(props) {\n  const { firebase } = React.useContext(FirebaseContext);\n  const [links, setLinks] = React.useState([]);\n  const [cursor, setCursor] = React.useState(null);\n  const [loading, setLoading] = React.useState(false);\n  const isNewPage = props.location.pathname.includes(\"new\");\n  const isTopPage = props.location.pathname.includes(\"top\");\n  const page = Number(props.match.params.page);\n  const linksRef = firebase.db.collection(\"links\");\n\n  React.useEffect(() => {\n    const unsubscribe = getLinks();\n    return () => unsubscribe();\n  }, [isTopPage, page]);\n\n  function getLinks() {\n    const hasCursor = Boolean(cursor);\n    setLoading(true);\n    if (isTopPage) {\n      return linksRef\n        .orderBy(\"voteCount\", \"desc\")\n        .limit(LINKS_PER_PAGE)\n        .onSnapshot(handleSnapshot);\n    } else if (page === 1) {\n      return linksRef\n        .orderBy(\"created\", \"desc\")\n        .limit(LINKS_PER_PAGE)\n        .onSnapshot(handleSnapshot);\n    } else if (hasCursor) {\n      return linksRef\n        .orderBy(\"created\", \"desc\")\n        .startAfter(cursor.created)\n        .limit(LINKS_PER_PAGE)\n        .onSnapshot(handleSnapshot);\n    } else {\n      const offset = page * LINKS_PER_PAGE - LINKS_PER_PAGE;\n      axios\n        .get(\n          `https://us-central1-hooks-news-app.cloudfunctions.net/linksPagination?offset=${offset}`\n        )\n        .then(response => {\n          const links = response.data;\n          const lastLink = links[links.length - 1];\n          setLinks(links);\n          setCursor(lastLink);\n          setLoading(false);\n        });\n      return () => {};\n    }\n  }\n\n  function handleSnapshot(snapshot) {\n    const links = snapshot.docs.map(doc => {\n      return { id: doc.id, ...doc.data() };\n    });\n    const lastLink = links[links.length - 1];\n    setLinks(links);\n    setCursor(lastLink);\n    setLoading(false);\n  }\n\n  function visitPreviousPage() {\n    if (page > 1) {\n      props.history.push(`/new/${page - 1}`);\n    }\n  }\n\n  function visitNextPage() {\n    if (page <= links.length / LINKS_PER_PAGE) {\n      props.history.push(`/new/${page + 1}`);\n    }\n  }\n\n  const pageIndex = page ? (page - 1) * LINKS_PER_PAGE + 1 : 0;\n\n  return (\n    <div style={{ opacity: loading ? 0.25 : 1 }}>\n      {links.map((link, index) => (\n        <LinkItem\n          key={link.id}\n          showCount={true}\n          link={link}\n          index={index + pageIndex}\n        />\n      ))}\n      {isNewPage && (\n        <div className=\"pagination\">\n          <div className=\"pointer mr2\" onClick={visitPreviousPage}>\n            Previous\n          </div>\n          <div className=\"pointer\" onClick={visitNextPage}>\n            Next\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default LinkList;\n"]},"metadata":{},"sourceType":"module"}