{"ast":null,"code":"/**\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar RESERVED_BITS = 1;\nvar GeneratorIds;\n\n(function (GeneratorIds) {\n  GeneratorIds[GeneratorIds[\"LocalStore\"] = 0] = \"LocalStore\";\n  GeneratorIds[GeneratorIds[\"SyncEngine\"] = 1] = \"SyncEngine\";\n})(GeneratorIds || (GeneratorIds = {}));\n/**\n * TargetIdGenerator generates monotonically increasing integer IDs. There are\n * separate generators for different scopes. While these generators will operate\n * independently of each other, they are scoped, such that no two generators\n * will ever produce the same ID. This is useful, because sometimes the backend\n * may group IDs from separate parts of the client into the same ID space.\n */\n\n\nvar TargetIdGenerator =\n/** @class */\nfunction () {\n  function TargetIdGenerator(generatorId, initAfter) {\n    if (initAfter === void 0) {\n      initAfter = 0;\n    }\n\n    this.generatorId = generatorId; // Replace the generator part of initAfter with this generator's ID.\n\n    var afterWithoutGenerator = initAfter >> RESERVED_BITS << RESERVED_BITS;\n    var afterGenerator = initAfter - afterWithoutGenerator;\n\n    if (afterGenerator >= generatorId) {\n      // For example, if:\n      //   this.generatorId = 0b0000\n      //   after = 0b1011\n      //   afterGenerator = 0b0001\n      // Then:\n      //   previous = 0b1010\n      //   next = 0b1100\n      this.previousId = afterWithoutGenerator | this.generatorId;\n    } else {\n      // For example, if:\n      //   this.generatorId = 0b0001\n      //   after = 0b1010\n      //   afterGenerator = 0b0000\n      // Then:\n      //   previous = 0b1001\n      //   next = 0b1011\n      this.previousId = (afterWithoutGenerator | this.generatorId) - (1 << RESERVED_BITS);\n    }\n  }\n\n  TargetIdGenerator.prototype.next = function () {\n    this.previousId += 1 << RESERVED_BITS;\n    return this.previousId;\n  };\n\n  TargetIdGenerator.forLocalStore = function (initAfter) {\n    if (initAfter === void 0) {\n      initAfter = 0;\n    }\n\n    return new TargetIdGenerator(GeneratorIds.LocalStore, initAfter);\n  };\n\n  TargetIdGenerator.forSyncEngine = function () {\n    return new TargetIdGenerator(GeneratorIds.SyncEngine);\n  };\n\n  return TargetIdGenerator;\n}();\n\nexport { TargetIdGenerator };","map":null,"metadata":{},"sourceType":"module"}